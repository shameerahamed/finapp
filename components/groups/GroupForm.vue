<script>
export default {
  data() {
    return {
      groupName: '',
      groupAmount: null,
      groupTrnsIds: [],
    }
  },

  methods: {
    async handleCreateGroup() {
      const isFormValid = this.validateForm()
      if (isFormValid) {
        const values = {
          amount: this.groupAmount,
          currency: this.$store.state.currencies.base,
          name: this.groupName,
          trnsIds: this.groupTrnsIds,
        }

        await this.$store.dispatch('groups/createGroup', values)
        this.groupName = null
        this.groupAmount = null
      }
    },

    validateForm() {
      if (!this.groupName) {
        const groupNameRef = this.$refs.groupNameRef
        this.focusInputName(groupNameRef)
        groupNameRef.classList.remove('_error')
        setTimeout(() => { groupNameRef.classList.add('_error') }, 10)
        return false
      }

      return true
    },

    focusInputName(ref) {
      ref.querySelector('.inputText__value').focus()
    },

    isSelectedTrn(trnId) {
      return this.groupTrnsIds.includes(trnId)
    },

    handleSelectTrn(trnId) {
      this.groupTrnsIds.includes(trnId)
        ? this.groupTrnsIds = this.groupTrnsIds.filter(item => item !== trnId)
        : this.groupTrnsIds.push(trnId)
    },
  },
}
</script>

<template lang="pug">
.form
  .form__title {{ $t('groups.form.title') }}
  .form__group(ref="groupNameRef")
    .inputText__label {{ $t('groups.form.name') }}
    .inputText
      input.inputText__value(
        type="text"
        :placeholder="`${$t('groups.form.name')}...`"
        v-model="groupName")

  .button.mb-6(@click="handleCreateGroup") {{ $t('groups.form.button') }}
</template>

<style lang="stylus" scoped>
@import '~assets/stylus/variables'

.form
  overflow hidden
  margin-top $m7
  padding $m8
  border 1px solid var(--c-item-bg-main)
  border-radius $borderRadiusMd

  &__title
    font-header-1()
    margin-bottom 30px

  &__group
    padding-bottom 30px
    &._error
      animation shake .5s linear

.inputText__value
  height 40px
  padding 0 16px
  font-size 16px
  background var(--c-bg-1)
  border 1px solid var(--c-bg-7)
  border-radius 3px

  &._number
    font-size 22px
    font-secondary()
    &::placeholder
      font-primary()
      font-size 16px

  &:focus
    border-color var(--c-bg-9)

.inputText__label
  margin 0
  padding 0
  padding-bottom 10px
  font-size 11px
  border 0

@keyframes shake
  8%
  41%
    transform translateX(-10px)
  25%
  58%
    transform translateX(10px)
  75%
    transform translateX(-5px)
  92%
    transform translateX(5px)
  0%
  100%
    transform translateX(0)
</style>
